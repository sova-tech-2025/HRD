"""
–£—Ç–∏–ª–∏—Ç—ã –¥–ª—è E2E-—Ç–µ—Å—Ç–æ–≤: –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏–π –±–æ—Ç–∞, –∑–∞–¥–µ—Ä–∂–∫–∏.
"""

import asyncio
import re
from typing import Optional


def extract_invite_code(text: str) -> Optional[str]:
    """
    –ò–∑–≤–ª–µ—á—å –∏–Ω–≤–∞–π—Ç-–∫–æ–¥ –∫–æ–º–ø–∞–Ω–∏–∏ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç–∞.

    –ò—â–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—ã:
    - "–ö–æ–¥ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è: XXXXX"
    - "–∫–æ–¥: XXXXX"
    - –ö–æ–¥ –≤ –æ–±—Ä–∞—Ç–Ω—ã—Ö –∫–∞–≤—ã—á–∫–∞—Ö: `XXXXX`
    """
    # –ü–∞—Ç—Ç–µ—Ä–Ω 1: "–ö–æ–¥ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è: XXXXX" –∏–ª–∏ "–ö–æ–¥: XXXXX"
    match = re.search(r"[–ö–∫]–æ–¥(?:\s+–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è)?[:\s]+([A-Za-z0-9–ê-–Ø–∞-—è—ë–Å_-]{4,30})", text)
    if match:
        return match.group(1).strip()

    # –ü–∞—Ç—Ç–µ—Ä–Ω 2: –∫–æ–¥ –≤ –æ–±—Ä–∞—Ç–Ω—ã—Ö –∫–∞–≤—ã—á–∫–∞—Ö
    match = re.search(r"`([A-Za-z0-9_-]{4,30})`", text)
    if match:
        return match.group(1)

    return None


def extract_emoji_status(text: str, item_name: str) -> Optional[str]:
    """
    –ù–∞–π—Ç–∏ —Å—Ç–∞—Ç—É—Å-–∏–∫–æ–Ω–∫—É (‚úÖ/üü°/‚õîÔ∏è) –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ —Ç–µ–∫—Å—Ç–µ.

    Args:
        text: —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç–∞
        item_name: –Ω–∞–∑–≤–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ (—Ç–µ—Å—Ç, —ç—Ç–∞–ø)

    Returns:
        –≠–º–æ–¥–∑–∏-—Å—Ç–∞—Ç—É—Å –∏–ª–∏ None
    """
    # –ò—â–µ–º –∏–∫–æ–Ω–∫—É —Ä—è–¥–æ–º —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º —ç–ª–µ–º–µ–Ω—Ç–∞
    pattern = rf"(‚úÖ|üü°|‚õîÔ∏è|‚õî|‚ùå)\s*{re.escape(item_name)}"
    match = re.search(pattern, text)
    if match:
        return match.group(1)

    # –û–±—Ä–∞—Ç–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫: –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞—Ç–µ–º –∏–∫–æ–Ω–∫–∞
    pattern = rf"{re.escape(item_name)}\s*(‚úÖ|üü°|‚õîÔ∏è|‚õî|‚ùå)"
    match = re.search(pattern, text)
    if match:
        return match.group(1)

    return None


def contains_access_denied(text: str) -> bool:
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–∫–∞–∑ –≤ –¥–æ—Å—Ç—É–ø–µ."""
    denial_patterns = [
        "–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω",
        "–¥–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω",
        "–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω",
        "–¥–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω",
        "–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞",
        "–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞",
        "–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞",
        "—É –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞",
        "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤",
        "–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤",
    ]
    return any(p in text for p in denial_patterns)


def contains_test_passed(text: str) -> bool:
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—Å–ø–µ—à–Ω–æ–º –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–∏ —Ç–µ—Å—Ç–∞."""
    pass_patterns = [
        "–¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω",
        "—Ç–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω",
        "–í—ã –ø—Ä–æ—à–ª–∏ —Ç–µ—Å—Ç",
        "–≤—ã –ø—Ä–æ—à–ª–∏ —Ç–µ—Å—Ç",
        "–†–µ–∑—É–ª—å—Ç–∞—Ç: –ü—Ä–æ–π–¥–µ–Ω",
        "‚úÖ",
    ]
    return any(p in text for p in pass_patterns)


def extract_score(text: str) -> Optional[int]:
    """–ò–∑–≤–ª–µ—á—å –Ω–∞–±—Ä–∞–Ω–Ω—ã–µ –±–∞–ª–ª—ã –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Ç–µ—Å—Ç–∞."""
    match = re.search(r"(\d+)\s*(?:–∏–∑|/)\s*\d+\s*(?:–±–∞–ª–ª–æ–≤|–±–∞–ª–ª|–±\.)", text)
    if match:
        return int(match.group(1))

    match = re.search(r"(?:–ë–∞–ª–ª—ã|–†–µ–∑—É–ª—å—Ç–∞—Ç|–ù–∞–±—Ä–∞–Ω–æ)[:\s]+(\d+)", text)
    if match:
        return int(match.group(1))

    return None


async def wait_between_actions(seconds: float = 2.0) -> None:
    """–Ø–≤–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –¥–µ–π—Å—Ç–≤–∏—è–º–∏ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏."""
    await asyncio.sleep(seconds)
